<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>pwr4exp: Power Analysis for Experimental Designs • pwr4exp</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="pwr4exp: Power Analysis for Experimental Designs">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pwr4exp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/pwr4exp.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/an-ethz/pwr4exp/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>pwr4exp: Power Analysis for Experimental Designs</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/an-ethz/pwr4exp/blob/main/vignettes/pwr4exp.Rmd" class="external-link"><code>vignettes/pwr4exp.Rmd</code></a></small>
      <div class="d-none name"><code>pwr4exp.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><code>pwr4exp</code> provides tools for statistical power calculation
in experimental designs analyzed within the linear mixed model
framework, including both fixed-effects and mixed-effects models.
Currently, the package does not support generalized linear models; thus,
only normal response variables are supported. Degrees of freedom are
approximated using the Satterthwaite method.</p>
<p>This vignette is based on the development version of the package,
which incorporates various correlation structures in repeated measures
and spatial data. It also includes options for generating input
templates, simplifying the setup and execution of power analyses. The
development version can be downloaded from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"an-ethz/pwr4exp"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/an-ethz/pwr4exp" class="external-link">pwr4exp</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="package-overview">Package overview<a class="anchor" aria-label="anchor" href="#package-overview"></a>
</h3>
<p>Performing a power analysis in <code>pwr4exp</code> involves two main
steps:</p>
<ol style="list-style-type: decimal">
<li><p><a href="#design">Create a design object</a>: A design object, on
which the power analysis will be conducted, needs to be created first.
This is done using the function <a href="#mkdesign"><strong><code>mkdesign</code></strong></a> for any
designs, or the functions <a href="#designCRD"><strong><code>designCRD</code></strong></a>, <a href="#designRCBD"><strong><code>designRCBD</code></strong></a>, <a href="#designLSD"><strong><code>designLSD</code></strong></a>, <a href="#designCOD"><strong><code>designCOD</code></strong></a>, and <a href="#designSPD"><strong><code>designSPD</code></strong></a> for the
specific designs.</p></li>
<li><p><a href="#power">Calculate power</a>: The statistical power of
the F-test for model terms and the t-test for specific contrasts can be
evaluated using the functions <a href="#pwr.anova"><strong><code>pwr.anova</code></strong></a> <a href="#pwr.contrast"><strong><code>pwr.contrast</code></strong></a></p></li>
</ol>
<p>The sections following the introduction are dedicated to these two
steps. Additional theory and concepts are listed at the end.</p>
</div>
</div>
<div class="section level2">
<h2 id="design">Create a design object<a class="anchor" aria-label="anchor" href="#design"></a>
</h2>
<div class="section level3">
<h3 id="mkdesign">mk_design<a class="anchor" aria-label="anchor" href="#mkdesign"></a>
</h3>
<p>The function <code>mkdesign</code> is designed to create any design
by specifying the design’s data structure, the intended model, and the
necessary parameters.</p>
<p><strong>Inputs</strong></p>
<ul>
<li>
<code>formula</code>: The right-hand-side model formula (uses
<code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer()</a></code> syntax for random effects).</li>
<li>
<code>data</code>: A long-format data frame with one row per
observation and columns for all independent variables specified in the
formula (e.g., treatments, blocks, subjects). The data should reflect
the design structure but exclude the response variable. Unused variables
in the <code>formula</code> are ignored.</li>
<li>
<code>beta</code> or <code>means</code>: Fixed-effects expectations.
Specify either <code>beta</code> (a vector of regression coefficients)
or <code>means</code> (expected mean values for fixed effects). Only one
of these must be provided.</li>
<li>
<code>vcomp</code>: Expected variance-covariance components for the
random effects.</li>
<li>
<code>sigma2</code>: Expected error variance (residual
variance).</li>
<li>
<code>correlation</code>: Correlation structure for repeated
measures or spatial data.</li>
<li>
<code>template</code>: Logical; when <code>TRUE</code>, generates
templates for <code>beta</code>, <code>means</code>, and
<code>vcomp</code> instead of the full design object.</li>
</ul>
<p><strong>Output</strong></p>
<ul>
<li>Returns a list of essential components required for power
calculation functions.</li>
</ul>
</div>
<div class="section level3">
<h3 id="templates">Templates<a class="anchor" aria-label="anchor" href="#templates"></a>
</h3>
<p>Templates for <code>beta</code>, <code>means</code>, and
<code>vcomp</code> can be generated when <code>template = TRUE</code> or
when only the formula and data are provided. These templates serve as
guides, outlining the elements and the order of parameter values in
<code>beta</code>, <code>means</code>, and <code>vcomp</code>, based on
the model and data structure.</p>
<p>Below, we create an example data frame to illustrate these templates,
which may not represent a realistic design. The data frame includes:</p>
<ul>
<li>Four categorical variables (<code>fA</code>, <code>fB</code>,
<code>fC</code>, <code>fD</code>), and</li>
<li>Two numerical variables (<code>x</code>, <code>z</code>).</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span>
<span>   fA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="co"># factor A with 2 levels</span></span>
<span>   fB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>, <span class="co"># factor B with 2 levels</span></span>
<span>   fC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="co"># factor C with 3 levels</span></span>
<span>   fD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>, <span class="co"># factor D with 3 levels</span></span>
<span>   subject <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span>  <span class="co"># 10 subjects for each combination of factors</span></span>
<span> <span class="op">)</span></span>
<span> <span class="va">df1</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Numerical variable x</span></span>
<span> <span class="va">df1</span><span class="op">$</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Numerical variable z</span></span></code></pre></div>
<div class="section level4">
<h4 id="beta-template">
<code>beta</code> template:<a class="anchor" aria-label="anchor" href="#beta-template"></a>
</h4>
<p>The template for <code>beta</code> specifies the order of model
coefficients as they would appear in a fitted model. It is especially
useful when directly providing expected model coefficients as measures
of effect size.</p>
<p>For example, the expected values of the model coefficients for
<code>~ fA*fB + x</code> should be provided in the following
sequence:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mkdesign.html">mkdesign</a></span><span class="op">(</span> <span class="op">~</span> <span class="va">fA</span> <span class="op">*</span> <span class="va">fB</span> <span class="op">+</span> <span class="va">x</span>, <span class="va">df1</span><span class="op">)</span><span class="op">$</span><span class="va">fixeff</span><span class="op">$</span><span class="va">beta</span></span>
<span><span class="co">#&gt; (Intercept)         fA2         fB2           x     fA2:fB2 </span></span>
<span><span class="co">#&gt;           1           2           3           4           5</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="means-template">
<code>means</code> template:<a class="anchor" aria-label="anchor" href="#means-template"></a>
</h4>
<p>In many situations, it is more direct and convenient to provide means
for categorical variables. The template for <code>means</code>
represents marginal means for categorical variables, regression
coefficients for numerical variables, and conditional means or
regression coefficients for interactions.</p>
<p><strong>Categorical variables without interactions</strong></p>
<p>Marginal means for each level of the categorical variable(s) are
required. For example, the expectations for each level of
<code>fA</code> and <code>fB</code> follow this sequence:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mkdesign.html">mkdesign</a></span><span class="op">(</span><span class="op">~</span> <span class="va">fA</span> <span class="op">+</span> <span class="va">fB</span>, <span class="va">df1</span>, template <span class="op">=</span> <span class="cn">T</span><span class="op">)</span><span class="op">$</span><span class="va">fixeff</span><span class="op">$</span><span class="va">means</span></span>
<span><span class="co">#&gt; fA1 fA2 fB1 fB2 </span></span>
<span><span class="co">#&gt;   1   2   3   4</span></span></code></pre></div>
<p><strong>Interactions among categorical variables</strong></p>
<p>Conditional (cell) means are required for all combinations of levels
of the interacting categorical variables. For instance, cell means for
all 12 combinations of the levels of <code>fA</code>, <code>fB</code>,
and <code>fC</code>, are required in the following order:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mkdesign.html">mkdesign</a></span><span class="op">(</span><span class="op">~</span> <span class="va">fA</span> <span class="op">*</span> <span class="va">fB</span> <span class="op">*</span> <span class="va">fC</span>, <span class="va">df1</span><span class="op">)</span><span class="op">$</span><span class="va">fixeff</span><span class="op">$</span><span class="va">means</span></span>
<span><span class="co">#&gt; fA1:fB1:fC1 fA2:fB1:fC1 fA1:fB2:fC1 fA2:fB2:fC1 fA1:fB1:fC2 fA2:fB1:fC2 </span></span>
<span><span class="co">#&gt;           1           2           3           4           5           6 </span></span>
<span><span class="co">#&gt; fA1:fB2:fC2 fA2:fB2:fC2 fA1:fB1:fC3 fA2:fB1:fC3 fA1:fB2:fC3 fA2:fB2:fC3 </span></span>
<span><span class="co">#&gt;           7           8           9          10          11          12</span></span></code></pre></div>
<p><strong>Numerical variables</strong></p>
<p>Regression coefficients are required for numerical variables. If the
model includes only numerical variables, the <code>(intercept)</code>
must also be included. In such cases, <code>means</code> are identical
to <code>beta</code>.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mkdesign.html">mkdesign</a></span><span class="op">(</span><span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, <span class="va">df1</span><span class="op">)</span><span class="op">$</span><span class="va">fixeff</span><span class="op">$</span><span class="va">means</span></span>
<span><span class="co">#&gt; (Intercept)           x           z </span></span>
<span><span class="co">#&gt;           1           2           3</span></span></code></pre></div>
<p>If there are interactions between numerical variables, regression
coefficients for both main effects and interaction terms are required.
Such as:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mkdesign.html">mkdesign</a></span><span class="op">(</span><span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">z</span>, <span class="va">df1</span><span class="op">)</span><span class="op">$</span><span class="va">fixeff</span><span class="op">$</span><span class="va">means</span></span>
<span><span class="co">#&gt; (Intercept)           x           z         x:z </span></span>
<span><span class="co">#&gt;           1           2           3           4</span></span></code></pre></div>
<p><strong>Categorical-by-numerical interactions</strong></p>
<p>Marginal means for the categorical variable and regression
coefficients for the numerical variable at each level of the categorical
variable are required. For example, the means for levels of
<code>fA</code> and regression coefficients for <code>x</code> at each
level of <code>fA</code> are required for the model
<code>~ fA * x</code>:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mkdesign.html">mkdesign</a></span><span class="op">(</span><span class="op">~</span> <span class="va">fA</span> <span class="op">*</span> <span class="va">x</span>, <span class="va">df1</span><span class="op">)</span><span class="op">$</span><span class="va">fixeff</span><span class="op">$</span><span class="va">means</span></span>
<span><span class="co">#&gt;   fA1   fA2 fA1:x fA2:x </span></span>
<span><span class="co">#&gt;     1     2     3     4</span></span></code></pre></div>
<p><strong>Combining Multiple Situations</strong></p>
<p>The rules for categorical and numerical variables described above
also apply in mixed situations. For example, consider a model combining:
- Interactions among three categorical variables (<code>fA</code>,
<code>fB</code>, <code>fC</code>) - A categorical-by-numerical
interaction (<code>fD * x</code>)<br>
- Main effects for another numerical variable (<code>z</code>)</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mkdesign.html">mkdesign</a></span><span class="op">(</span><span class="op">~</span> <span class="va">fA</span> <span class="op">*</span> <span class="va">fB</span> <span class="op">*</span> <span class="va">fC</span> <span class="op">+</span> <span class="va">fD</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, <span class="va">df1</span><span class="op">)</span><span class="op">$</span><span class="va">fixeff</span><span class="op">$</span><span class="va">means</span></span>
<span><span class="co">#&gt;         fD1         fD2         fD3           z       fD1:x       fD2:x </span></span>
<span><span class="co">#&gt;           1           2           3           4           5           6 </span></span>
<span><span class="co">#&gt;       fD3:x fA1:fB1:fC1 fA2:fB1:fC1 fA1:fB2:fC1 fA2:fB2:fC1 fA1:fB1:fC2 </span></span>
<span><span class="co">#&gt;           7           8           9          10          11          12 </span></span>
<span><span class="co">#&gt; fA2:fB1:fC2 fA1:fB2:fC2 fA2:fB2:fC2 fA1:fB1:fC3 fA2:fB1:fC3 fA1:fB2:fC3 </span></span>
<span><span class="co">#&gt;          13          14          15          16          17          18 </span></span>
<span><span class="co">#&gt; fA2:fB2:fC3 </span></span>
<span><span class="co">#&gt;          19</span></span></code></pre></div>
<p>The required elements and their order in <code>means</code> are: -
Means for each level of <code>fD</code> (positions 1-3) - Regression
coefficients for <code>z</code> (position 4) - Regression coefficients
for <code>x</code> at each level of <code>fD</code> (positions 5-7) -
Cell means for all combinations of levels of <code>fA</code>,
<code>fB</code>, and <code>fC</code> (positions 8-19)</p>
</div>
<div class="section level4">
<h4 id="vcomp-template">
<code>vcomp</code> template:<a class="anchor" aria-label="anchor" href="#vcomp-template"></a>
</h4>
<p>The template for <code>vcomp</code> represents a variance-covariance
matrix, where integers indicate the order of variance components in the
input vector.</p>
<p>For a single random effect, a template is unnecessary, as it
corresponds to a single variance value. For multiple random effects, the
template outlines the sequence of variance and covariance components to
be provided. It helps users specify and align variance components for
random effects in the model.</p>
<p>For example, a model contains both random intercept and random slop
for <code>fA</code> by <code>subject</code>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mkdesign.html">mkdesign</a></span><span class="op">(</span><span class="op">~</span> <span class="va">fA</span> <span class="op">*</span> <span class="va">fB</span> <span class="op">*</span> <span class="va">fC</span> <span class="op">*</span> <span class="va">fD</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">fA</span> <span class="op">|</span> <span class="va">subject</span><span class="op">)</span>, <span class="va">df1</span><span class="op">)</span><span class="op">$</span><span class="va">varcov</span></span>
<span><span class="co">#&gt; $subject</span></span>
<span><span class="co">#&gt;             (Intercept) fA2</span></span>
<span><span class="co">#&gt; (Intercept)           1   2</span></span>
<span><span class="co">#&gt; fA2                   2   3</span></span></code></pre></div>
<p>The template specifies the following required inputs: 1. Variance of
the random intercept (1st component) 2. Covariance between the random
intercept and fA2 (2nd component) 3. Variance of fA2 (3rd component)</p>
<p><strong>Note</strong>: This example may not be statistically correct
for the given data. It is provided solely to illustrate the structure of
variance-covariance templates.</p>
</div>
</div>
<div class="section level3">
<h3 id="correlation-structures">Correlation structures<a class="anchor" aria-label="anchor" href="#correlation-structures"></a>
</h3>
<p>Various correlation structures can be specified following the
instructions from <a href="%22https://rdrr.io/cran/nlme/man/corClasses.html%22" class="external-link"><code>nlme::corClasses</code></a>,
including - <a href="%22https://rdrr.io/cran/nlme/man/corAR1.html%22" class="external-link"><code>corAR1</code></a>
- <a href="%22https://rdrr.io/cran/nlme/man/corARMA.html%22" class="external-link"><code>corARMA</code></a>
- <a href="%22https://rdrr.io/cran/nlme/man/corCAR1.html%22" class="external-link"><code>corCAR1</code></a>
- <a href="%22https://rdrr.io/cran/nlme/man/corCompSymm.html%22" class="external-link"><code>corCompSymm</code></a>
- <a href="%22https://rdrr.io/cran/nlme/man/corExp.html%22" class="external-link"><code>corExp</code></a>
- <a href="%22https://rdrr.io/cran/nlme/man/corGaus.html%22" class="external-link"><code>corGaus</code></a>
- <a href="%22https://rdrr.io/cran/nlme/man/corLin.html%22" class="external-link"><code>corLin</code></a>
- <a href="%22https://rdrr.io/cran/nlme/man/corSymm.html%22" class="external-link"><code>corSymm</code></a>
- <a href="%22https://rdrr.io/cran/nlme/man/corRatio.html%22" class="external-link"><code>corRatio</code></a>
- <a href="%22https://rdrr.io/cran/nlme/man/corSpher.html%22" class="external-link"><code>corSpher</code></a></p>
<p>Note: In <code><a href="https://rdrr.io/pkg/nlme/man/corAR1.html" class="external-link">nlme::corAR1()</a></code> and <code><a href="https://rdrr.io/pkg/nlme/man/corARMA.html" class="external-link">nlme::corARMA()</a></code>
when <code>p=1</code> and <code>q=0</code>, the time variable must be an
integer. However, in <code>pwr4exp</code>, this restriction has been
released, factors are also supported.</p>
</div>
<div class="section level3">
<h3 id="specific-design-functions">Specific design functions<a class="anchor" aria-label="anchor" href="#specific-design-functions"></a>
</h3>
<p>While <code>mkdesign</code> is highly flexible for creating any
design, as long as the design’s data structure is provided,
<code>pwr4exp</code> also includes specific functions for some common
standard designs. These specialized functions define a design by its
characteristics, such as treatment structure and replications,
simplifying the process of manually creating a data frame.</p>
<div class="section level4">
<h4 id="completely-randomized-design">Completely randomized design<a class="anchor" aria-label="anchor" href="#completely-randomized-design"></a>
</h4>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_designs.html">designCRD</a></span><span class="op">(</span><span class="va">treatments</span>, <span class="va">label</span>, <span class="va">replicates</span>, <span class="va">formula</span>, <span class="va">beta</span>, <span class="va">means</span>, <span class="va">sigma2</span>, template <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="randomized-complete-block-design">Randomized complete block design<a class="anchor" aria-label="anchor" href="#randomized-complete-block-design"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_designs.html">designRCBD</a></span><span class="op">(</span><span class="va">treatments</span>, <span class="va">label</span>, <span class="va">blocks</span>, <span class="va">formula</span>, <span class="va">beta</span>, <span class="va">means</span>, <span class="va">vcomp</span>, <span class="va">sigma2</span>, template <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="latin-square-design">Latin square design<a class="anchor" aria-label="anchor" href="#latin-square-design"></a>
</h4>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_designs.html">designLSD</a></span><span class="op">(</span><span class="va">treatments</span>, <span class="va">label</span>, <span class="va">squares</span>, <span class="va">reuse</span>, <span class="va">formula</span>, <span class="va">beta</span>, <span class="va">means</span>, <span class="va">vcomp</span>, <span class="va">sigma2</span>, template <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="crossover-design">Crossover design<a class="anchor" aria-label="anchor" href="#crossover-design"></a>
</h4>
<p>This is a special case of LSD where time periods and individuals act
as blocks. Period blocks are reused when replicating squares.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_designs.html">designCOD</a></span><span class="op">(</span><span class="va">treatments</span>, <span class="va">label</span>, <span class="va">squares</span>, <span class="va">formula</span>, <span class="va">beta</span>, <span class="va">means</span>, <span class="va">vcomp</span>, <span class="va">sigma2</span>, template <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="split-plot-design">Split-plot design<a class="anchor" aria-label="anchor" href="#split-plot-design"></a>
</h4>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_designs.html">designSPD</a></span><span class="op">(</span><span class="va">trt.main</span>, <span class="va">trt.sub</span>, <span class="va">label</span>, <span class="va">replicates</span>, <span class="va">formula</span>, <span class="va">beta</span>, <span class="va">means</span>, <span class="va">vcomp</span>, <span class="va">sigma2</span>, template <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>The inputs for these functions are the same as those for
<code>mkdesign</code>, except that <code>data</code> is replaced by
specifying the treatment profile and the number of replications.</p>
<p><strong>Specific inputs</strong></p>
<ul>
<li><p><code>treatments</code>: a integer-valued vector specifying the
number of levels of treatment factors. A maximum of two factors is
allowed, and arranged in a factorial design. For example,
<code>treatments = c(3, 2)</code> specifies one treatment factor with 3
levels and another with 2 levels, forming a factorial treatment
design.</p></li>
<li><p><code>trt.main</code> and <code>trt.sub</code>: define the
treatments on main plot and subplot, respectively, following the same
rules of <code>treatment</code>.</p></li>
<li><p><code>label</code>: an optional list, whose entries are labels to
used for factor levels and whose names are treatment factors. If
<code>label</code> is not specified, default names and labels are
assigned to the factors and levels. For one treatment factor, the
default is <code>list(trt = c("1", "2", ...))</code>. For two factors,
the default is
<code>list(facA = c("1", "2", ...), facB = c("1", "2", ...))</code>,
where “facA” and “facB” represent the two factors, and “1”, “2”, etc.,
represent the levels of each factor.</p></li>
<li><p><code>replicates</code>: the number of experimental units per
treatment in a CRD or the number of main plots (i.e., the number of
experimental units per treatment at the main plot level) in a
SPD.</p></li>
<li><p><code>blocks</code>: the number of blocks in a RCBD.</p></li>
<li><p><code>squares</code>: the number of squares in a replicated LSD
or COD.</p></li>
<li><p><code>reuse</code>: specifies how to replicate squares when there
are multiple squares. One of: <code>row</code> for reusing row blocks,
<code>col</code> for reusing column blocks, or <code>both</code> for
reusing both row and column blocks to replicate a single
square.</p></li>
</ul>
<p>Each of these specific design-generating functions has a default
<code>formula</code> based on the treatment structure (e.g., one factor
or factorial factors). If <code>formula</code> is not specified, a
default formula with main effects and all interactions (if applicable)
is used internally. In RCBD, LSD, COD, and SPD designs, all block
factors are fitted as random effects. The <code>formula</code> component
in the output list can be inspected.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="power-calculation">Power calculation<a class="anchor" aria-label="anchor" href="#power-calculation"></a>
</h2>
<p>Once the design object has been created, calculating power is
straightforward. Statistical power of F-test for for omnibus tests can
be calculated using the <code>pwr.anova</code> function.</p>
<p><strong>Inputs</strong> - <code>object</code>: the design object
created in the previous step - <code>sig.level</code>: significance
level, default 0.05 - <code>type</code>: the type of ANOVA table,
default Type III</p>
<p>Statistical power of t-test for specific contrast can be evaluated
using the <code>pwr.contrast</code> function.</p>
<p><strong>Inputs</strong> - <code>object</code>: the design object -
<code>which</code>: the factor of interest - <code>by</code>: the
variable to condition on - <code>contrast</code>: contrast method,
include “pairwise”, “poly”, and “trt.vs.ctrl”, or any manually defined
contrast vector - <code>sig.level</code>: significance level, default
0.05 - <code>p.adj</code>: whether the sig.level should be adjusted
using the Bonferroni method, default FALSE - <code>alternative</code>:
“two.sided” or “one.sided”. - <code>strict</code>: If <code>TRUE</code>,
default, the power will include the probability of rejection in the
opposite direction of the true effect, in the two-sided case. Otherwise,
the power will be half the significance level if the true difference is
zero.</p>
</div>
<div class="section level2">
<h2 id="practical-examples">Practical Examples<a class="anchor" aria-label="anchor" href="#practical-examples"></a>
</h2>
<div class="section level3">
<h3 id="example-1--completely-randomized-design">Example 1. Completely Randomized Design<a class="anchor" aria-label="anchor" href="#example-1--completely-randomized-design"></a>
</h3>
<p>In this example, we will create a CRD with one treatment factor. The
design parameters are as follows:</p>
<ol style="list-style-type: decimal">
<li>Treatments: 1 treatment factor with 4 levels.</li>
<li>Replicates: 8 experimental units per treatment.</li>
<li>Mean and effect size: The expected means for four levels are 35, 30,
37, 38</li>
<li>Error variance: 15</li>
</ol>
<p><strong>Create the CRD</strong></p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">crd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_designs.html">designCRD</a></span><span class="op">(</span></span>
<span>  treatments <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  replicates <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">35</span>, <span class="fl">30</span>, <span class="fl">37</span>, <span class="fl">38</span><span class="op">)</span>,</span>
<span>  sigma2 <span class="op">=</span> <span class="fl">15</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Power for omnibus test</strong></p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pwr.anova.html">pwr.anova</a></span><span class="op">(</span><span class="va">crd</span><span class="op">)</span></span>
<span><span class="co">#&gt; Power of type III F-test</span></span>
<span><span class="co">#&gt;     NumDF DenDF sig.level   power</span></span>
<span><span class="co">#&gt; trt     3    28      0.05 0.95467</span></span></code></pre></div>
<p><strong>Power for specific contrasts</strong></p>
<p>The power for detecting differences between treatments and the
control:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pwr.contrast.html">pwr.contrast</a></span><span class="op">(</span><span class="va">crd</span>, which <span class="op">=</span>  <span class="st">"trt"</span>, contrast <span class="op">=</span> <span class="st">"trt.vs.ctrl"</span><span class="op">)</span></span>
<span><span class="co">#&gt;             effect df sig.level     power alternative</span></span>
<span><span class="co">#&gt; trt2 - trt1     -5 28      0.05 0.7028739   two.sided</span></span>
<span><span class="co">#&gt; trt3 - trt1      2 28      0.05 0.1694975   two.sided</span></span>
<span><span class="co">#&gt; trt4 - trt1      3 28      0.05 0.3216803   two.sided</span></span></code></pre></div>
<p>The power for detecting polynomial contrasts across the treatment
levels:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pwr.contrast.html">pwr.contrast</a></span><span class="op">(</span><span class="va">crd</span>, which <span class="op">=</span>  <span class="st">"trt"</span>, contrast <span class="op">=</span> <span class="st">"poly"</span><span class="op">)</span></span>
<span><span class="co">#&gt;           effect df sig.level     power alternative</span></span>
<span><span class="co">#&gt; linear        16 28      0.05 0.7130735   two.sided</span></span>
<span><span class="co">#&gt; quadratic      6 28      0.05 0.5617849   two.sided</span></span>
<span><span class="co">#&gt; cubic        -18 28      0.05 0.8098383   two.sided</span></span></code></pre></div>
<p>The power for detecting pairwise comparison.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pwr.contrast.html">pwr.contrast</a></span><span class="op">(</span><span class="va">crd</span>, which <span class="op">=</span>  <span class="st">"trt"</span>, contrast <span class="op">=</span> <span class="st">"pairwise"</span><span class="op">)</span></span>
<span><span class="co">#&gt;             effect df sig.level      power alternative</span></span>
<span><span class="co">#&gt; trt1 - trt2      5 28      0.05 0.70287390   two.sided</span></span>
<span><span class="co">#&gt; trt1 - trt3     -2 28      0.05 0.16949749   two.sided</span></span>
<span><span class="co">#&gt; trt1 - trt4     -3 28      0.05 0.32168033   two.sided</span></span>
<span><span class="co">#&gt; trt2 - trt3     -7 28      0.05 0.93677955   two.sided</span></span>
<span><span class="co">#&gt; trt2 - trt4     -8 28      0.05 0.97860686   two.sided</span></span>
<span><span class="co">#&gt; trt3 - trt4     -1 28      0.05 0.07896844   two.sided</span></span></code></pre></div>
<p>In data analysis, the <strong>P-value</strong> or
<strong>significance level</strong> often needs to be adjusted for
multiple comparisons (MCP). Most commonly used methods for MCP in
experimental data are post-hoc, meaning they cannot be directly applied
during the power analysis stage. However, one can tune the significance
level to mimic these situations—for instance, by using a lower
significance level to account for MCP.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pwr.contrast.html">pwr.contrast</a></span><span class="op">(</span><span class="va">crd</span>, which <span class="op">=</span>  <span class="st">"trt"</span>, contrast <span class="op">=</span> <span class="st">"pairwise"</span>, sig.level <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="co">#&gt;             effect df sig.level     power alternative</span></span>
<span><span class="co">#&gt; trt1 - trt2      5 28      0.01 0.4418907   two.sided</span></span>
<span><span class="co">#&gt; trt1 - trt3     -2 28      0.01 0.0546995   two.sided</span></span>
<span><span class="co">#&gt; trt1 - trt4     -3 28      0.01 0.1320866   two.sided</span></span>
<span><span class="co">#&gt; trt2 - trt3     -7 28      0.01 0.7946290   two.sided</span></span>
<span><span class="co">#&gt; trt2 - trt4     -8 28      0.01 0.9042775   two.sided</span></span>
<span><span class="co">#&gt; trt3 - trt4     -1 28      0.01 0.0194487   two.sided</span></span></code></pre></div>
<p>The <code>pwr.contrast</code> function also includes an option to
adjust the significance level using the <strong>Bonferroni
method</strong>, though this approach may be overly conservative.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pwr.contrast.html">pwr.contrast</a></span><span class="op">(</span><span class="va">crd</span>, which <span class="op">=</span>  <span class="st">"trt"</span>, contrast <span class="op">=</span> <span class="st">"pairwise"</span>, sig.level <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="co">#&gt;             effect df sig.level     power alternative</span></span>
<span><span class="co">#&gt; trt1 - trt2      5 28      0.01 0.4418907   two.sided</span></span>
<span><span class="co">#&gt; trt1 - trt3     -2 28      0.01 0.0546995   two.sided</span></span>
<span><span class="co">#&gt; trt1 - trt4     -3 28      0.01 0.1320866   two.sided</span></span>
<span><span class="co">#&gt; trt2 - trt3     -7 28      0.01 0.7946290   two.sided</span></span>
<span><span class="co">#&gt; trt2 - trt4     -8 28      0.01 0.9042775   two.sided</span></span>
<span><span class="co">#&gt; trt3 - trt4     -1 28      0.01 0.0194487   two.sided</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-2--randomized-complete-block-design">Example 2. Randomized complete block design<a class="anchor" aria-label="anchor" href="#example-2--randomized-complete-block-design"></a>
</h3>
<p>In this example, we will create an RCBD with two treatment factors.
The design parameters are as follows:</p>
<ol style="list-style-type: decimal">
<li>Treatments: A 2x2 factorial design.</li>
<li>Replicates: 8 blocks.</li>
<li>Means:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="center" style="text-align: center"></mtd><mtd columnalign="center" style="text-align: center"><mi>B</mi><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>B</mi><mn>2</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>A</mi><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>35</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>38</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>A</mi><mn>2</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>40</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>41</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"></mtd></mtr></mtable><annotation encoding="application/x-tex">
    \begin{array}{c|c|c}
 &amp; B1 &amp; B2 \\
    \hline
    A1 &amp; 35 &amp; 38 \\
    A2 &amp; 40  &amp; 41 \\
    \end{array}
    </annotation></semantics></math> The corresponding <code>beta</code>
values are as follows:</li>
</ol>
<ul>
<li>The intercept (<code>A1B1</code>): 35.</li>
<li>The effect of <code>A2</code> alone: 5 units</li>
<li>The effect of <code>B2</code> alone: 3 units</li>
<li>The interaction between <code>A2</code> and <code>B2</code>: -2
units, meaning the combined effect of <code>A2</code> and
<code>B2</code> is 2 units below the additive effects.</li>
</ul>
<ol start="4" style="list-style-type: decimal">
<li>Variance among blocks: 11.</li>
<li>Error variance: 4. The total variance of the response variable (15)
is decomposed into variance between blocks (11) and variance within
blocks (4).</li>
</ol>
<p><strong>Create the RCBD</strong></p>
<ul>
<li>templates:</li>
</ul>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_designs.html">designRCBD</a></span><span class="op">(</span>treatments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, blocks <span class="op">=</span> <span class="fl">8</span>, template <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $fixeff</span></span>
<span><span class="co">#&gt; $fixeff$beta</span></span>
<span><span class="co">#&gt; (Intercept)       facA2       facB2 facA2:facB2 </span></span>
<span><span class="co">#&gt;           1           2           3           4 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fixeff$means</span></span>
<span><span class="co">#&gt; facA1:facB1 facA2:facB1 facA1:facB2 facA2:facB2 </span></span>
<span><span class="co">#&gt;           1           2           3           4 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $varcov</span></span>
<span><span class="co">#&gt; $varcov$block</span></span>
<span><span class="co">#&gt;             (Intercept)</span></span>
<span><span class="co">#&gt; (Intercept)           1</span></span></code></pre></div>
<p>Provide design paramters, <code>beta</code> or <code>means</code>,
and <code>vcomp</code> according to the order above.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rcbd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_designs.html">designRCBD</a></span><span class="op">(</span></span>
<span>  treatments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  blocks <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  <span class="co"># beta = c(35, 5, 3, -2), # identical to means</span></span>
<span>  means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">35</span>, <span class="fl">40</span>, <span class="fl">38</span>, <span class="fl">41</span><span class="op">)</span>,</span>
<span>  vcomp <span class="op">=</span> <span class="fl">11</span>,</span>
<span>  sigma2 <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Evaluate statistical power</strong></p>
<p>The power for main and interaction effects.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pwr.anova.html">pwr.anova</a></span><span class="op">(</span><span class="va">rcbd</span><span class="op">)</span></span>
<span><span class="co">#&gt; Power of type III F-test</span></span>
<span><span class="co">#&gt;           NumDF DenDF sig.level   power</span></span>
<span><span class="co">#&gt; facA          1    21      0.05 0.99969</span></span>
<span><span class="co">#&gt; facB          1    21      0.05 0.76950</span></span>
<span><span class="co">#&gt; facA:facB     1    21      0.05 0.27138</span></span></code></pre></div>
<p>The power for testing difference between levels of factor A
conditioned on factor B:</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pwr.contrast.html">pwr.contrast</a></span><span class="op">(</span><span class="va">rcbd</span>, which <span class="op">=</span> <span class="st">"facA"</span>, by <span class="op">=</span> <span class="st">"facB"</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`facB = 1`</span></span>
<span><span class="co">#&gt;               effect df sig.level     power alternative</span></span>
<span><span class="co">#&gt; facA1 - facA2     -5 21      0.05 0.9974502   two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`facB = 2`</span></span>
<span><span class="co">#&gt;               effect df sig.level     power alternative</span></span>
<span><span class="co">#&gt; facA1 - facA2     -3 21      0.05 0.8160596   two.sided</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-3--latin-square-design">Example 3. Latin square design<a class="anchor" aria-label="anchor" href="#example-3--latin-square-design"></a>
</h3>
<p>In this example, we extend the design from <em>Example 2</em> by
introducing another blocking factor, thus creating an LSD. The treatment
structure and effect sizes remain the same as in <em>Example 2</em>. The
design controls for two sources of variability (row and column blocks)
while evaluating the treatment effects. In the LSD, the total variance
(15) is further decomposed into three components:</p>
<ul>
<li>Variance between row blocks (11),</li>
<li>Variance between column blocks (2), and</li>
<li>Residual error variance (2).</li>
</ul>
<p><strong>Input templates</strong></p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_designs.html">designLSD</a></span><span class="op">(</span></span>
<span>  treatments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  squares <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  reuse <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>  template <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; $fixeff</span></span>
<span><span class="co">#&gt; $fixeff$beta</span></span>
<span><span class="co">#&gt; (Intercept)       facA2       facB2 facA2:facB2 </span></span>
<span><span class="co">#&gt;           1           2           3           4 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fixeff$means</span></span>
<span><span class="co">#&gt; facA1:facB1 facA2:facB1 facA1:facB2 facA2:facB2 </span></span>
<span><span class="co">#&gt;           1           2           3           4 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $varcov</span></span>
<span><span class="co">#&gt; $varcov$row</span></span>
<span><span class="co">#&gt;             (Intercept)</span></span>
<span><span class="co">#&gt; (Intercept)           1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $varcov$col</span></span>
<span><span class="co">#&gt;             (Intercept)</span></span>
<span><span class="co">#&gt; (Intercept)           2</span></span></code></pre></div>
<p>Either <code>beta</code> or <code>means</code> can be provided as in
<em>Example 2</em>. Variance of row blocking factors and column block
factors are requried sequentially.</p>
<p><strong>Create the LSD</strong></p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lsd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_designs.html">designLSD</a></span><span class="op">(</span></span>
<span>  treatments <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  label <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>temp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"T1"</span>, <span class="st">"T2"</span><span class="op">)</span>, dosage <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"D1"</span>, <span class="st">"D2"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  squares <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  reuse <span class="op">=</span> <span class="st">"both"</span>,</span>
<span>  means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">35</span>, <span class="fl">40</span>, <span class="fl">38</span>, <span class="fl">41</span><span class="op">)</span>,</span>
<span>  vcomp <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">11</span>, <span class="fl">2</span><span class="op">)</span>,</span>
<span>  sigma2 <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Once the design has been created, <code>pwr.anova</code> and
<code>pwr.contrast</code> can be used to evaludate statistical power as
demonstrated above.</p>
</div>
<div class="section level3">
<h3 id="example-4-split-plot-design">Example 4: Split-plot Design<a class="anchor" aria-label="anchor" href="#example-4-split-plot-design"></a>
</h3>
<p>In this example, we will create a SPD with two treatment factors, one
at each level. The design parameters are as follows:</p>
<ol style="list-style-type: decimal">
<li>Treatments: One main plot factor having 2 levels, and another factor
with 3 levels at the sub-plot level.</li>
<li>
<strong>Replicates</strong>: There are 5 plots per main plot
treatment, resulting in a total of 10 plots. This is a standard SPD,
where the plot (block at the subplot level) size is assumed to equal the
number of treatments. Thus, the design follows an RCBD structure at the
subplot level.</li>
<li>The corresponding cell means are:
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="center" style="text-align: center"></mtd><mtd columnalign="center" style="text-align: center"><mi>t</mi><mi>r</mi><mi>t</mi><mi>.</mi><mi>s</mi><mi>u</mi><mi>b</mi><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>t</mi><mi>r</mi><mi>t</mi><mi>.</mi><mi>s</mi><mi>u</mi><mi>b</mi><mn>2</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>t</mi><mi>r</mi><mi>t</mi><mi>.</mi><mi>s</mi><mi>u</mi><mi>b</mi><mn>3</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>t</mi><mi>r</mi><mi>t</mi><mi>.</mi><mi>m</mi><mi>a</mi><mi>i</mi><mi>n</mi><mn>1</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>20</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>22</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>24</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>t</mi><mi>r</mi><mi>t</mi><mi>.</mi><mi>m</mi><mi>a</mi><mi>i</mi><mi>n</mi><mn>2</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>22</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>24</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>28</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{array}{c|c|c}
  &amp; trt.sub1 &amp; trt.sub2 &amp; trt.sub3 \\
\hline
trt.main1 &amp; 20 &amp; 22 &amp; 24\\
trt.main2 &amp; 22 &amp; 24 &amp; 28 \\
\end{array}
</annotation></semantics></math>
</li>
<li>The total variance (15) is assumed to decompose into 4 for
whole-plot error and 11 for subplot error.</li>
</ol>
<p><strong>Inputs templates</strong></p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/create_designs.html">designSPD</a></span><span class="op">(</span></span>
<span>  trt.main <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  trt.sub <span class="op">=</span> <span class="fl">3</span>, </span>
<span>  replicates <span class="op">=</span> <span class="fl">10</span>, </span>
<span>  template <span class="op">=</span> <span class="cn">T</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Only rhs formula is required</span></span>
<span><span class="co">#&gt; formula coerced to: ~(1 | mainplot) + trt.main + trt.sub + trt.main:trt.sub.</span></span>
<span><span class="co">#&gt; $fixeff</span></span>
<span><span class="co">#&gt; $fixeff$beta</span></span>
<span><span class="co">#&gt;        (Intercept)          trt.main2           trt.sub2           trt.sub3 </span></span>
<span><span class="co">#&gt;                  1                  2                  3                  4 </span></span>
<span><span class="co">#&gt; trt.main2:trt.sub2 trt.main2:trt.sub3 </span></span>
<span><span class="co">#&gt;                  5                  6 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fixeff$means</span></span>
<span><span class="co">#&gt; trt.main1:trt.sub1 trt.main2:trt.sub1 trt.main1:trt.sub2 trt.main2:trt.sub2 </span></span>
<span><span class="co">#&gt;                  1                  2                  3                  4 </span></span>
<span><span class="co">#&gt; trt.main1:trt.sub3 trt.main2:trt.sub3 </span></span>
<span><span class="co">#&gt;                  5                  6 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $varcov</span></span>
<span><span class="co">#&gt; $varcov$mainplot</span></span>
<span><span class="co">#&gt;             (Intercept)</span></span>
<span><span class="co">#&gt; (Intercept)           1</span></span></code></pre></div>
<p><strong>Create the SPD</strong></p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">spd</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_designs.html">designSPD</a></span><span class="op">(</span></span>
<span>  trt.main <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  trt.sub <span class="op">=</span> <span class="fl">3</span>, </span>
<span>  replicates <span class="op">=</span> <span class="fl">10</span>, </span>
<span>  means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">22</span>, <span class="fl">22</span>, <span class="fl">24</span>, <span class="fl">24</span>, <span class="fl">28</span><span class="op">)</span>,</span>
<span>  vcomp <span class="op">=</span> <span class="fl">4</span>,</span>
<span>  sigma2 <span class="op">=</span> <span class="fl">11</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Only rhs formula is required</span></span>
<span><span class="co">#&gt; formula coerced to: ~(1 | mainplot) + trt.main + trt.sub + trt.main:trt.sub.</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="example-5-repeated-measures">Example 5: Repeated measures<a class="anchor" aria-label="anchor" href="#example-5-repeated-measures"></a>
</h3>
<p>This example illustrates a repeated measures design with three
treatments (<code>CON</code>, <code>TRT1</code>, <code>TRT2</code>)
measured hourly over 8 hours. Within-subject correlations are modeled
using an AR(1) structure with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ρ</mi><mo>=</mo><mn>0.6</mn></mrow><annotation encoding="application/x-tex">\rho = 0.6</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>σ</mi><mn>2</mn></msup><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">\sigma^2 = 2</annotation></semantics></math>.</p>
<p><strong>Design Details</strong> 1. <strong>Subjects</strong>: 6 per
treatment group (total: 18 subjects).<br>
2. <strong>Treatments</strong>: <code>CON</code>, <code>TRT1</code>, and
<code>TRT2</code>.<br>
3. <strong>Time Points</strong>: 8 hourly measurements.</p>
<p>4.
<strong>Means</strong>:<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="center" style="text-align: center"><mtext mathvariant="bold">𝐓𝐫𝐞𝐚𝐭𝐦𝐞𝐧𝐭</mtext></mtd><mtd columnalign="center" style="text-align: center"><mtext mathvariant="bold">𝟏</mtext></mtd><mtd columnalign="center" style="text-align: center"><mtext mathvariant="bold">𝟐</mtext></mtd><mtd columnalign="center" style="text-align: center"><mtext mathvariant="bold">𝟑</mtext></mtd><mtd columnalign="center" style="text-align: center"><mtext mathvariant="bold">𝟒</mtext></mtd><mtd columnalign="center" style="text-align: center"><mtext mathvariant="bold">𝟓</mtext></mtd><mtd columnalign="center" style="text-align: center"><mtext mathvariant="bold">𝟔</mtext></mtd><mtd columnalign="center" style="text-align: center"><mtext mathvariant="bold">𝟕</mtext></mtd><mtd columnalign="center" style="text-align: center"><mtext mathvariant="bold">𝟖</mtext></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mtext mathvariant="normal">CON</mtext></mtd><mtd columnalign="center" style="text-align: center"><mn>1.00</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1.00</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1.00</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1.00</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1.00</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1.00</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1.00</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>1.00</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mtext mathvariant="normal">TRT1</mtext></mtd><mtd columnalign="center" style="text-align: center"><mn>2.50</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>3.50</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>3.98</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>4.03</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>3.68</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>3.35</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>3.02</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>2.94</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mtext mathvariant="normal">TRT2</mtext></mtd><mtd columnalign="center" style="text-align: center"><mn>3.50</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>4.54</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>5.80</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>5.84</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>5.49</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>4.71</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>4.08</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>3.78</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"></mtd></mtr></mtable><annotation encoding="application/x-tex">
\begin{array}{c|cccccccc}
\textbf{Treatment} &amp; \textbf{1} &amp; \textbf{2} &amp; \textbf{3} &amp; \textbf{4} &amp; \textbf{5} &amp; \textbf{6} &amp; \textbf{7} &amp; \textbf{8} \\
\hline
\text{CON} &amp; 1.00 &amp; 1.00 &amp; 1.00 &amp; 1.00 &amp; 1.00 &amp; 1.00 &amp; 1.00 &amp; 1.00 \\
\text{TRT1} &amp; 2.50 &amp; 3.50 &amp; 3.98 &amp; 4.03 &amp; 3.68 &amp; 3.35 &amp; 3.02 &amp; 2.94 \\
\text{TRT2} &amp; 3.50 &amp; 4.54 &amp; 5.80 &amp; 5.84 &amp; 5.49 &amp; 4.71 &amp; 4.08 &amp; 3.78 \\
\end{array}
</annotation></semantics></math></p>
<p><strong>Create a data frame for this design</strong></p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">n_subject</span> <span class="op">=</span> <span class="fl">6</span> <span class="co"># Subjects per treatment</span></span>
<span><span class="va">n_trt</span> <span class="op">=</span> <span class="fl">3</span> <span class="co"># Number of treatments</span></span>
<span><span class="va">n_hour</span> <span class="op">=</span> <span class="fl">8</span> <span class="co"># Number of repeated measures (time points)</span></span>
<span><span class="va">trt</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CON"</span>, <span class="st">"TRT1"</span>, <span class="st">"TRT2"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">df.rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  subject <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_trt</span><span class="op">*</span><span class="va">n_subject</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">n_hour</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  hour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_hour</span><span class="op">)</span>, <span class="va">n_subject</span><span class="op">*</span><span class="va">n_trt</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">trt</span>, each <span class="op">=</span> <span class="va">n_subject</span><span class="op">*</span><span class="va">n_hour</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Input templates</strong></p>
<p>Either values of <code>beta</code> or <code>means</code> are required
in the following order:</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/mkdesign.html">mkdesign</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">trt</span><span class="op">*</span><span class="va">hour</span>, data <span class="op">=</span> <span class="va">df.rep</span><span class="op">)</span></span>
<span><span class="co">#&gt; $fixeff</span></span>
<span><span class="co">#&gt; $fixeff$beta</span></span>
<span><span class="co">#&gt;   (Intercept)       trtTRT1       trtTRT2         hour2         hour3 </span></span>
<span><span class="co">#&gt;             1             2             3             4             5 </span></span>
<span><span class="co">#&gt;         hour4         hour5         hour6         hour7         hour8 </span></span>
<span><span class="co">#&gt;             6             7             8             9            10 </span></span>
<span><span class="co">#&gt; trtTRT1:hour2 trtTRT2:hour2 trtTRT1:hour3 trtTRT2:hour3 trtTRT1:hour4 </span></span>
<span><span class="co">#&gt;            11            12            13            14            15 </span></span>
<span><span class="co">#&gt; trtTRT2:hour4 trtTRT1:hour5 trtTRT2:hour5 trtTRT1:hour6 trtTRT2:hour6 </span></span>
<span><span class="co">#&gt;            16            17            18            19            20 </span></span>
<span><span class="co">#&gt; trtTRT1:hour7 trtTRT2:hour7 trtTRT1:hour8 trtTRT2:hour8 </span></span>
<span><span class="co">#&gt;            21            22            23            24 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $fixeff$means</span></span>
<span><span class="co">#&gt;  trtCON:hour1 trtTRT1:hour1 trtTRT2:hour1  trtCON:hour2 trtTRT1:hour2 </span></span>
<span><span class="co">#&gt;             1             2             3             4             5 </span></span>
<span><span class="co">#&gt; trtTRT2:hour2  trtCON:hour3 trtTRT1:hour3 trtTRT2:hour3  trtCON:hour4 </span></span>
<span><span class="co">#&gt;             6             7             8             9            10 </span></span>
<span><span class="co">#&gt; trtTRT1:hour4 trtTRT2:hour4  trtCON:hour5 trtTRT1:hour5 trtTRT2:hour5 </span></span>
<span><span class="co">#&gt;            11            12            13            14            15 </span></span>
<span><span class="co">#&gt;  trtCON:hour6 trtTRT1:hour6 trtTRT2:hour6  trtCON:hour7 trtTRT1:hour7 </span></span>
<span><span class="co">#&gt;            16            17            18            19            20 </span></span>
<span><span class="co">#&gt; trtTRT2:hour7  trtCON:hour8 trtTRT1:hour8 trtTRT2:hour8 </span></span>
<span><span class="co">#&gt;            21            22            23            24 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $varcov</span></span>
<span><span class="co">#&gt; NULL</span></span></code></pre></div>
<p><strong>Create a design</strong></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">design.rep</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/mkdesign.html">mkdesign</a></span><span class="op">(</span></span>
<span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">trt</span><span class="op">*</span><span class="va">hour</span>,</span>
<span>data <span class="op">=</span> <span class="va">df.rep</span>,</span>
<span>means <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2.50</span>, <span class="fl">3.5</span>,</span>
<span>           <span class="fl">1</span>, <span class="fl">3.50</span>, <span class="fl">4.54</span>,</span>
<span>           <span class="fl">1</span>, <span class="fl">3.98</span>, <span class="fl">5.80</span>,</span>
<span>           <span class="fl">1</span>, <span class="fl">4.03</span>, <span class="fl">5.4</span>,</span>
<span>           <span class="fl">1</span>, <span class="fl">3.68</span>, <span class="fl">5.49</span>,</span>
<span>           <span class="fl">1</span>, <span class="fl">3.35</span>, <span class="fl">4.71</span>,</span>
<span>           <span class="fl">1</span>, <span class="fl">3.02</span>, <span class="fl">4.08</span>,</span>
<span>           <span class="fl">1</span>, <span class="fl">2.94</span>, <span class="fl">3.78</span><span class="op">)</span>,</span>
<span>sigma2 <span class="op">=</span> <span class="fl">2</span>,</span>
<span>correlation <span class="op">=</span> <span class="fu">corAR1</span><span class="op">(</span>value <span class="op">=</span> <span class="fl">0.6</span>, form <span class="op">=</span> <span class="op">~</span> <span class="va">hour</span><span class="op">|</span><span class="va">subject</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><strong>Power calculation</strong></p>
<p>Statistical power for main effects of treatment and time, and their
interaction:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pwr.anova.html">pwr.anova</a></span><span class="op">(</span><span class="va">design.rep</span><span class="op">)</span></span>
<span><span class="co">#&gt; Power of type III F-test</span></span>
<span><span class="co">#&gt;          NumDF  DenDF sig.level   power</span></span>
<span><span class="co">#&gt; trt          2 21.563      0.05 1.00000</span></span>
<span><span class="co">#&gt; hour         7 86.055      0.05 0.74687</span></span>
<span><span class="co">#&gt; trt:hour    14 86.055      0.05 0.38500</span></span></code></pre></div>
<p>Statistical power for treatment difference at each hour:</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/pwr.contrast.html">pwr.contrast</a></span><span class="op">(</span><span class="va">design.rep</span>, which <span class="op">=</span> <span class="st">"trt"</span>, by <span class="op">=</span> <span class="st">"hour"</span>, contrast <span class="op">=</span> <span class="st">"trt.vs.ctrl"</span>, p.adj <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $`hour = 1`</span></span>
<span><span class="co">#&gt;                  effect       df sig.level     power alternative</span></span>
<span><span class="co">#&gt; trtTRT1 - trtCON    1.5 64.41176     0.025 0.3299823   two.sided</span></span>
<span><span class="co">#&gt; trtTRT2 - trtCON    2.5 64.41176     0.025 0.7765112   two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`hour = 2`</span></span>
<span><span class="co">#&gt;                  effect       df sig.level     power alternative</span></span>
<span><span class="co">#&gt; trtTRT1 - trtCON   2.50 64.41176     0.025 0.7765112   two.sided</span></span>
<span><span class="co">#&gt; trtTRT2 - trtCON   3.54 64.41176     0.025 0.9777118   two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`hour = 3`</span></span>
<span><span class="co">#&gt;                  effect       df sig.level     power alternative</span></span>
<span><span class="co">#&gt; trtTRT1 - trtCON   2.98 64.41176     0.025 0.9093209   two.sided</span></span>
<span><span class="co">#&gt; trtTRT2 - trtCON   4.80 64.41176     0.025 0.9997845   two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`hour = 4`</span></span>
<span><span class="co">#&gt;                  effect       df sig.level     power alternative</span></span>
<span><span class="co">#&gt; trtTRT1 - trtCON   3.03 64.41176     0.025 0.9187320   two.sided</span></span>
<span><span class="co">#&gt; trtTRT2 - trtCON   4.40 64.41176     0.025 0.9988191   two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`hour = 5`</span></span>
<span><span class="co">#&gt;                  effect       df sig.level     power alternative</span></span>
<span><span class="co">#&gt; trtTRT1 - trtCON   2.68 64.41176     0.025 0.8355960   two.sided</span></span>
<span><span class="co">#&gt; trtTRT2 - trtCON   4.49 64.41176     0.025 0.9991794   two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`hour = 6`</span></span>
<span><span class="co">#&gt;                  effect       df sig.level     power alternative</span></span>
<span><span class="co">#&gt; trtTRT1 - trtCON   2.35 64.41176     0.025 0.7191810   two.sided</span></span>
<span><span class="co">#&gt; trtTRT2 - trtCON   3.71 64.41176     0.025 0.9865382   two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`hour = 7`</span></span>
<span><span class="co">#&gt;                  effect       df sig.level     power alternative</span></span>
<span><span class="co">#&gt; trtTRT1 - trtCON   2.02 64.41176     0.025 0.5730989   two.sided</span></span>
<span><span class="co">#&gt; trtTRT2 - trtCON   3.08 64.41176     0.025 0.9273867   two.sided</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $`hour = 8`</span></span>
<span><span class="co">#&gt;                  effect       df sig.level     power alternative</span></span>
<span><span class="co">#&gt; trtTRT1 - trtCON   1.94 64.41176     0.025 0.5351535   two.sided</span></span>
<span><span class="co">#&gt; trtTRT2 - trtCON   2.78 64.41176     0.025 0.8635795   two.sided</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="fundamental-concepts">Fundamental concepts<a class="anchor" aria-label="anchor" href="#fundamental-concepts"></a>
</h2>
<p><code>pwr4exp</code> is developed based on linear mixed model (LMM)
theory. The general form of an LMM can be expressed as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mi>X</mi><mi>β</mi><mo>+</mo><mi>Z</mi><mi>u</mi><mo>+</mo><mi>ε</mi></mrow><annotation encoding="application/x-tex">
y = X\beta + Zu + \varepsilon
</annotation></semantics></math></p>
<p>where:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
represents the observations of the response variable,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
represents the fixed effect coefficients,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>
denotes the random effects, where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>u</mi><mo>∼</mo><msub><mi>N</mi><mi>q</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>G</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">u \sim N_q(0, G)</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ε</mi><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math>
represents the random errors, where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ε</mi><mo>∼</mo><msub><mi>N</mi><mi>n</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>R</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\varepsilon \sim N_n(0, R)</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo>×</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow></msub><annotation encoding="application/x-tex">X_{(n \times p)}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Z</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>n</mi><mo>×</mo><mi>q</mi><mo stretchy="true" form="postfix">)</mo></mrow></msub><annotation encoding="application/x-tex">Z_{(n \times q)}</annotation></semantics></math>
are the design matrices for the fixed and random effects,
respectively.</p>
<p>It is assumed that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>u</mi><annotation encoding="application/x-tex">u</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ε</mi><annotation encoding="application/x-tex">\varepsilon</annotation></semantics></math>
are independent, and the marginal distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>y</mi><annotation encoding="application/x-tex">y</annotation></semantics></math>
follows a normal distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>∼</mo><msub><mi>N</mi><mi>n</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>X</mi><mi>β</mi><mo>,</mo><mi>V</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">y \sim N_n(X\beta, V)</annotation></semantics></math>,
where:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>V</mi><mo>=</mo><mi>Z</mi><mi>G</mi><msup><mi>Z</mi><mi>T</mi></msup><mo>+</mo><mi>R</mi></mrow><annotation encoding="application/x-tex">
V = ZGZ^T + R
</annotation></semantics></math></p>
<div class="section level3">
<h3 id="inference-on-treatment-effects">Inference on Treatment Effects<a class="anchor" aria-label="anchor" href="#inference-on-treatment-effects"></a>
</h3>
<p>Inference on treatment effects often involves testing omnibus
hypotheses and contrasts. These can be formulated using the general
linear hypothesis:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><mi>K</mi><mi>β</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">
H_0: K\beta = 0
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>K</mi><annotation encoding="application/x-tex">K</annotation></semantics></math>
is a contrast matrix. When the variance-covariance parameters in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>G</mi><annotation encoding="application/x-tex">G</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>
are known, the estimate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>β</mi><mo accent="true">̂</mo></mover><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>X</mi><mi>T</mi></msup><msup><mi>V</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>X</mi><mi>T</mi></msup><msup><mi>V</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>y</mi></mrow><annotation encoding="application/x-tex">
\hat{\beta} = (X^TV^{-1}X)^{-1}X^TV^{-1}y
</annotation></semantics></math></p>
<p>And its variance is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>C</mi><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>X</mi><mi>T</mi></msup><msup><mi>V</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">
C = (X^TV^{-1}X)^{-1}
</annotation></semantics></math></p>
<p>The sampling distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mi>′</mi><mover><mi>β</mi><mo accent="true">̂</mo></mover></mrow><annotation encoding="application/x-tex">K'\hat{\beta}</annotation></semantics></math>
is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mi>′</mi><mover><mi>β</mi><mo accent="true">̂</mo></mover><mo>∼</mo><mi>N</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mi>K</mi><mi>′</mi><mi>C</mi><mi>K</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
K'\hat{\beta} \sim N(0, K'CK)
</annotation></semantics></math></p>
<p>However, in practical situations, the matrices
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>G</mi><annotation encoding="application/x-tex">G</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>
are unknown and must be estimated using methods like Maximum Likelihood
(ML) or Restricted ML (REML). The estimate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
is obtained by plugging in the estimated covariance matrices
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>V</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{V}</annotation></semantics></math>,
where:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>V</mi><mo accent="true">̂</mo></mover><mo>=</mo><mi>Z</mi><mover><mi>G</mi><mo accent="true">̂</mo></mover><msup><mi>Z</mi><mi>T</mi></msup><mo>+</mo><mover><mi>R</mi><mo accent="true">̂</mo></mover></mrow><annotation encoding="application/x-tex">
\hat{V} = Z\hat{G}Z^T + \hat{R}
</annotation></semantics></math></p>
<p>The resulting estimate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>β</mi><mo accent="true">̂</mo></mover><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>X</mi><mi>T</mi></msup><msup><mover><mi>V</mi><mo accent="true">̂</mo></mover><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><msup><mi>X</mi><mi>T</mi></msup><msup><mover><mi>V</mi><mo accent="true">̂</mo></mover><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>y</mi></mrow><annotation encoding="application/x-tex">
\hat{\beta} = (X^T\hat{V}^{-1}X)^{-1}X^T\hat{V}^{-1}y
</annotation></semantics></math></p>
<p>And its estimated variance is:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>C</mi><mo accent="true">̂</mo></mover><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>X</mi><mi>T</mi></msup><msup><mover><mi>V</mi><mo accent="true">̂</mo></mover><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>X</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding="application/x-tex">
\hat{C} = (X^T\hat{V}^{-1}X)^{-1}
</annotation></semantics></math></p>
<p>When testing the null hypothesis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><mi>K</mi><mi>β</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">H_0: K\beta = 0</annotation></semantics></math>,
an approximate F-statistic is used. The F-statistic is given by:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo>=</mo><mfrac><mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>K</mi><mover><mi>β</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mi>T</mi></msup><msup><mrow><mo stretchy="true" form="prefix">[</mo><mi>K</mi><mover><mi>C</mi><mo accent="true">̂</mo></mover><msup><mi>K</mi><mi>T</mi></msup><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>K</mi><mover><mi>β</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msub><mi>v</mi><mn>1</mn></msub></mfrac></mrow><annotation encoding="application/x-tex">
F = \frac{(K\hat{\beta})^T [K\hat{C}K^T]^{-1} (K\hat{\beta})}{v_1}
</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>F</mi><annotation encoding="application/x-tex">F</annotation></semantics></math>
follows an approximate F-distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>v</mi><mn>1</mn></msub><mo>,</mo><msub><mi>v</mi><mn>2</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F(v_1, v_2)</annotation></semantics></math>
under
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mn>1</mn></msub><mo>=</mo><mtext mathvariant="normal">rank</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>K</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>≥</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">v_1 = \text{rank}(K) \geq 1</annotation></semantics></math>
represents the numerator degrees of freedom (df),
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>v</mi><mn>2</mn></msub><annotation encoding="application/x-tex">v_2</annotation></semantics></math>
is the denominator df.</p>
<p>When
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">rank</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>K</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\text{rank}(K) = 1</annotation></semantics></math>,
the F-statistic simplifies to the square of the t-statistic:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mo>=</mo><msup><mi>t</mi><mn>2</mn></msup></mrow><annotation encoding="application/x-tex">
F = t^2
</annotation></semantics></math>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>t</mi><mo>=</mo><mfrac><mrow><mi>k</mi><mi>′</mi><mover><mi>β</mi><mo accent="true">̂</mo></mover></mrow><msqrt><mrow><mi>k</mi><mi>′</mi><mover><mi>C</mi><mo accent="true">̂</mo></mover><mi>K</mi></mrow></msqrt></mfrac></mrow><annotation encoding="application/x-tex">t = \frac{k'\hat{\beta}}{\sqrt{k'\hat{C}K}}</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>v</mi><mn>2</mn></msub><annotation encoding="application/x-tex">v_2</annotation></semantics></math>
df.</p>
<p>In balanced designs, where data is analyzed using a variance
components model—commonly applied in experimental animal
research—<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>v</mi><mn>2</mn></msub><annotation encoding="application/x-tex">v_2</annotation></semantics></math>​
can be precisely determined through degrees of freedom decomposition, as
applied in analysis of variance (ANOVA).</p>
<p>However, for more general cases,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>v</mi><mn>2</mn></msub><annotation encoding="application/x-tex">v_2</annotation></semantics></math>
must be approximated using methods.</p>
<p>The Satterthwaite approximation (Satterthwaite, 1946) for DF in
t-tests can be calculated as outlined by Giesbrecht and Burns
(1985):</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mn>2</mn></msub><mo>=</mo><mfrac><mrow><mn>2</mn><msup><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>k</mi><mi>T</mi></msup><mover><mi>C</mi><mo accent="true">̂</mo></mover><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><mrow><msup><mi>g</mi><mi>T</mi></msup><mi>A</mi><mi>g</mi></mrow></mfrac></mrow><annotation encoding="application/x-tex">
v_2 = \frac{2(k^T \hat{C} k)^2}{g^T A g}
</annotation></semantics></math></p>
<p>where: -
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>g</mi><annotation encoding="application/x-tex">g</annotation></semantics></math>
is the gradient of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mi>k</mi><mi>T</mi></msup><mi>C</mi><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>θ</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mi>k</mi></mrow><annotation encoding="application/x-tex">k^T C(\hat{\theta}) k</annotation></semantics></math>
with respect to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>,
the variance-covariance parameters in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>V</mi><annotation encoding="application/x-tex">V</annotation></semantics></math>,
evaluated at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>θ</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\theta}</annotation></semantics></math>.
- Matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
is the asymptotic variance-covariance matrix of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>θ</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\theta}</annotation></semantics></math>,
obtained from the information matrix of ML or REML estimation of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>θ</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\theta}</annotation></semantics></math>
(Stroup, 2012).</p>
<p>In F-tests,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>v</mi><mn>2</mn></msub><annotation encoding="application/x-tex">v_2</annotation></semantics></math>
can be calculated by following the procedures described by Fai and
Cornelius (1996). First,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mi>C</mi><msup><mover><mi>K</mi><mo accent="true">̂</mo></mover><mi>T</mi></msup></mrow><annotation encoding="application/x-tex">KC\hat{K}^T</annotation></semantics></math>
is decomposed to yield
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>K</mi><mi>C</mi><msup><mover><mi>K</mi><mo accent="true">̂</mo></mover><mi>T</mi></msup><mo>=</mo><msup><mi>P</mi><mi>T</mi></msup><mi>D</mi><mi>P</mi></mrow><annotation encoding="application/x-tex">KC\hat{K}^T = P^T D P</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>P</mi><annotation encoding="application/x-tex">P</annotation></semantics></math>
is an orthogonal matrix of eigenvectors, and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math>
is a diagonal matrix of eigenvalues. Define
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>m</mi></msub><mi>C</mi><msubsup><mi>k</mi><mi>m</mi><mi>T</mi></msubsup></mrow><annotation encoding="application/x-tex">k_m Ck_m^T</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>k</mi><mi>m</mi></msub><annotation encoding="application/x-tex">k_m</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>-th
row of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mi>K</mi></mrow><annotation encoding="application/x-tex">P K</annotation></semantics></math>,
and let:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mi>m</mi></msub><mo>=</mo><mfrac><mrow><mn>2</mn><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>D</mi><mi>m</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow><mrow><msubsup><mi>g</mi><mi>m</mi><mi>T</mi></msubsup><mi>A</mi><msub><mi>g</mi><mi>m</mi></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">
v_m = \frac{2(D_m)^2}{g_m^T A g_m}
</annotation></semantics></math></p>
<p>where: -
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>D</mi><mi>m</mi></msub><annotation encoding="application/x-tex">D_m</annotation></semantics></math>
is the
<math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>m</mi><annotation encoding="application/x-tex">m</annotation></semantics></math>-th
diagonal element of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>D</mi><annotation encoding="application/x-tex">D</annotation></semantics></math>.
-
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>g</mi><mi>m</mi></msub><annotation encoding="application/x-tex">g_m</annotation></semantics></math>
is the gradient of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>k</mi><mi>m</mi></msub><mi>C</mi><msubsup><mi>k</mi><mi>m</mi><mi>T</mi></msubsup></mrow><annotation encoding="application/x-tex">k_m C k_m^T</annotation></semantics></math>
with respect to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>θ</mi><annotation encoding="application/x-tex">\theta</annotation></semantics></math>,
evaluated at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>θ</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\theta}</annotation></semantics></math>.</p>
<p>Then let:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>E</mi><mo>=</mo><munderover><mo>∑</mo><mrow><mi>m</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>v</mi><mn>1</mn></msub></munderover><mfrac><msub><mi>v</mi><mi>m</mi></msub><mrow><msub><mi>v</mi><mi>m</mi></msub><mo>−</mo><mn>2</mn></mrow></mfrac><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>v</mi><mi>m</mi></msub><mo>&gt;</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
E = \sum_{m=1}^{v_1} \frac{v_m}{v_m - 2} I(v_m &gt; 2)
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>I</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>v</mi><mi>m</mi></msub><mo>&gt;</mo><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">I(v_m &gt; 2)</annotation></semantics></math>
denotes the indicator function. The denominator DF
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>v</mi><mn>2</mn></msub><annotation encoding="application/x-tex">v_2</annotation></semantics></math>
is calculated as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>v</mi><mn>2</mn></msub><mo>=</mo><mfrac><mrow><mn>2</mn><mi>E</mi></mrow><mrow><mi>E</mi><mo>−</mo><msub><mi>v</mi><mn>1</mn></msub></mrow></mfrac></mrow><annotation encoding="application/x-tex">
v_2 = \frac{2E}{E - v_1}
</annotation></semantics></math> The Satterthwaite approximation can be
applied in power analysis by plugging in the assumed values of variance
parameters (Stroup, 2002).</p>
</div>
<div class="section level3">
<h3 id="power-calculation-under-the-alternative-hypothesis">Power Calculation Under the Alternative Hypothesis<a class="anchor" aria-label="anchor" href="#power-calculation-under-the-alternative-hypothesis"></a>
</h3>
<p>Under the alternative hypothesis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>H</mi><mi>A</mi></msub><mo>:</mo><mi>K</mi><mi>′</mi><mi>β</mi><mo>≠</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">H_A: K'\beta \neq 0</annotation></semantics></math>,
the F-statistic follows a non-central distribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>F</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>v</mi><mn>1</mn></msub><mo>,</mo><msub><mi>v</mi><mn>2</mn></msub><mo>,</mo><mi>ϕ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">F(v_1, v_2, \phi)</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
is the non-centrality parameter that measures the departure from the
null hypothesis
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>.
The non-centrality parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>
is given by:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ϕ</mi><mo>=</mo><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>K</mi><mover><mi>β</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mi>T</mi></msup><msup><mrow><mo stretchy="true" form="prefix">[</mo><mi>K</mi><mover><mi>C</mi><mo accent="true">̂</mo></mover><msup><mi>K</mi><mi>T</mi></msup><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>K</mi><mover><mi>β</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\phi = (K\hat{\beta})^T [K\hat{C}K^T]^{-1} (K\hat{\beta})
</annotation></semantics></math></p>
<p>Once the distribution of the F-statistic under
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mi>A</mi></msub><annotation encoding="application/x-tex">H_A</annotation></semantics></math>
is known, the power of the test can be calculated as the conditional
probability of rejecting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>
when
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mi>A</mi></msub><annotation encoding="application/x-tex">H_A</annotation></semantics></math>
is true:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">Power</mtext><mo>=</mo><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mrow><mtext mathvariant="normal">reject </mtext><mspace width="0.333em"></mspace></mrow><msub><mi>H</mi><mn>0</mn></msub><mo>:</mo><mi>F</mi><mo>&gt;</mo><msub><mi>F</mi><mtext mathvariant="normal">crit</mtext></msub><mo>∣</mo><msub><mi>H</mi><mi>A</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\text{Power} = P(\text{reject } H_0: F &gt; F_{\text{crit}} \mid H_A)
</annotation></semantics></math></p>
<p>Where:
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>F</mi><mtext mathvariant="normal">crit</mtext></msub><annotation encoding="application/x-tex">F_{\text{crit}}</annotation></semantics></math>
is the critical value of the F-statistic used to reject
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>H</mi><mn>0</mn></msub><annotation encoding="application/x-tex">H_0</annotation></semantics></math>,
determined such that
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>P</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>F</mi><mo>&gt;</mo><msub><mi>F</mi><mtext mathvariant="normal">crit</mtext></msub><mo>∣</mo><msub><mi>H</mi><mn>0</mn></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">P(F &gt; F_{\text{crit}} \mid H_0) = \alpha</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
is the type I error rate.</p>
<p>The determination of the degrees of freedom
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>v</mi><mn>1</mn></msub><annotation encoding="application/x-tex">v_1</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>v</mi><mn>2</mn></msub><annotation encoding="application/x-tex">v_2</annotation></semantics></math>,
as well as the non-centrality parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ϕ</mi><annotation encoding="application/x-tex">\phi</annotation></semantics></math>,
are critical steps for power calculation.</p>
<p>Generally, power analysis requires specifying the following
components:</p>
<ul>
<li>The <strong>Design</strong> to be evaluated, which determines the
matrices
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>X</mi><annotation encoding="application/x-tex">X</annotation></semantics></math>
(fixed effects) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
(random effects).</li>
<li>The <strong>Treatment Effects</strong>, which determine
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>
(the fixed effect coefficients).</li>
<li>The <strong>Variance Components</strong>, which determine
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>G</mi><annotation encoding="application/x-tex">G</annotation></semantics></math>
(the covariance matrix of the random effects) and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>
(the covariance matrix of the residuals).</li>
</ul>
<p>A key aspect of conducting a valid power analysis is obtaining
<strong>reasonable estimates for the magnitude of the
parameters</strong> that will be used in the model. This includes:</p>
<ul>
<li>
<strong>Treatment Effects</strong>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>β</mi><annotation encoding="application/x-tex">\beta</annotation></semantics></math>):
The size of the treatment effect(s) you expect to detect. This can be
obtained from previous studies, pilot experiments, or subject-matter
expertise.</li>
<li>
<strong>Variance Components</strong>
(<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>G</mi><annotation encoding="application/x-tex">G</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>R</mi><annotation encoding="application/x-tex">R</annotation></semantics></math>):
These represent the variability in the random effects and residual
errors. Variance estimates are often obtained from:
<ul>
<li>
<strong>Pilot studies</strong> or preliminary data, which can
provide initial estimates of variability in random effects (e.g.,
subject-to-subject variability or group-level variability).</li>
<li>
<strong>Literature</strong> on similar experiments, where variance
components have been reported.</li>
<li>
<strong>Subject-matter expertise</strong>, where researchers provide
estimates based on their knowledge of the system being studied.</li>
</ul>
</li>
</ul>
<p>Performing a power analysis with unrealistic parameter magnitudes can
lead to incorrect conclusions, either overestimating the likelihood of
detecting a treatment effect or requiring an unnecessarily large sample
size.</p>
</div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Satterthwaite, F. E. 1946. An approximate distribution of estimates
of variance components. Biometrics Bull. 2:110–114. Hrong-Tai Fai, A.,
&amp; Cornelius, P. L. (1996). Approximate F-tests of multiple degree of
freedom hypotheses in generalized least squares analyses of unbalanced
split-plot experiments. Journal of statistical computation and
simulation, 54(4), 363-378.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kai Wang, Mutian Niu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
