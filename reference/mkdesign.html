<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Create a Design Object for Power Calculation — mkdesign • pwr4exp</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Create a Design Object for Power Calculation — mkdesign"><meta name="description" content="Generates a design object for power analysis by specifying a model formula and data frame.
This object is not a true experimental design as created by design generation procedures,
where randomization and unit allocation are performed.
Instead, it serves as an object containing all necessary information for power analysis,
including design matrices, assumed values of model effects, and other necessary components."><meta property="og:description" content="Generates a design object for power analysis by specifying a model formula and data frame.
This object is not a true experimental design as created by design generation procedures,
where randomization and unit allocation are performed.
Instead, it serves as an object containing all necessary information for power analysis,
including design matrices, assumed values of model effects, and other necessary components."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">pwr4exp</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/pwr4exp.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/an-ethz/pwr4exp/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Create a Design Object for Power Calculation</h1>
      <small class="dont-index">Source: <a href="https://github.com/an-ethz/pwr4exp/blob/main/R/mkdesign.R" class="external-link"><code>R/mkdesign.R</code></a></small>
      <div class="d-none name"><code>mkdesign.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Generates a design object for power analysis by specifying a model formula and data frame.
This object is not a true experimental design as created by design generation procedures,
where randomization and unit allocation are performed.
Instead, it serves as an object containing all necessary information for power analysis,
including design matrices, assumed values of model effects, and other necessary components.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">mkdesign</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  <span class="va">data</span>,</span>
<span>  beta <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  means <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  vcomp <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sigma2 <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  correlation <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  template <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  REML <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>A right-hand-side <a href="https://rdrr.io/r/stats/formula.html" class="external-link">formula</a> specifying the model for testing treatment effects,
with terms on the right of <a href="https://rdrr.io/r/base/tilde.html" class="external-link">~</a> , following <code><a href="https://rdrr.io/pkg/lme4/man/lmer.html" class="external-link">lme4::lmer()</a></code> syntax for random effects.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>A data frame with all independent variables specified in the model,
matching the design's structure.</p></dd>


<dt id="arg-beta">beta<a class="anchor" aria-label="anchor" href="#arg-beta"></a></dt>
<dd><p>One of the optional inputs for fixed effects.
A vector of model coefficients where factor variable coefficients correspond
to dummy variables created using "contr.treatment".</p></dd>


<dt id="arg-means">means<a class="anchor" aria-label="anchor" href="#arg-means"></a></dt>
<dd><p>One of the optional inputs for fixed effects.
A vector of marginal or conditioned means (if factors have interactions).
Regression coefficients are required for numerical variables.
Either <code>beta</code> or <code>means</code> must be provided, and their values must strictly follow a specific order.
A template can be created to indicate the required input values and their order.
See "Details" for more information.</p></dd>


<dt id="arg-vcomp">vcomp<a class="anchor" aria-label="anchor" href="#arg-vcomp"></a></dt>
<dd><p>A vector of variance-covariance components for random effects, if present.
The values must follow a strict order. See "Details".</p></dd>


<dt id="arg-sigma-">sigma2<a class="anchor" aria-label="anchor" href="#arg-sigma-"></a></dt>
<dd><p>error variance.</p></dd>


<dt id="arg-correlation">correlation<a class="anchor" aria-label="anchor" href="#arg-correlation"></a></dt>
<dd><p>Specifies correlation structures using <a href="https://rdrr.io/pkg/nlme/man/corClasses.html" class="external-link">nlme::corClasses</a> functions.
See "Details" for more information.</p></dd>


<dt id="arg-template">template<a class="anchor" aria-label="anchor" href="#arg-template"></a></dt>
<dd><p>Default is <code>FALSE</code>.
If <code>TRUE</code>, a template for <code>beta</code>, <code>means</code>, and <code>vcomp</code> is generated to indicate the required input order.</p></dd>


<dt id="arg-reml">REML<a class="anchor" aria-label="anchor" href="#arg-reml"></a></dt>
<dd><p>Specifies whether to use REML or ML estimates for variance-covariance parameters.
Default is <code>TRUE</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Additional arguments passed to internal functions.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A list object with all essential components for power calculation.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>

<ul><li><p><strong>data</strong>: A long-format data frame is required, as typically used in R for fitting linear models.
This data frame can be created manually or with the help of design creation packages
such as <a href="https://rdrr.io/pkg/agricolae/man/agricolae-package.html" class="external-link">agricolae</a>, <a href="https://rdrr.io/pkg/crossdes/man/crossdes-package.html" class="external-link">crossdes</a>, AlgDesign,
or <a href="https://rdrr.io/pkg/FrF2/man/FrF2.html" class="external-link">FrF2</a>.
It should include all independent variables specified in the model (e.g., treatments, blocks, subjects),
which are generally determined during the experimental design phase.
While the data frame may contain realizations of the response variable, these are not mandatory
and will be ignored if present.</p></li>
<li><p><strong>template</strong>: Templates are automatically generated when only the formula and data are supplied,
or explicitly if <code>template = TRUE</code>. Templates serve as guides for specifying inputs:</p><ul><li><p><strong>Template for <code>beta</code></strong>: Represents the sequence of model coefficients.</p></li>
<li><p><strong>Template for <code>means</code></strong>: Specifies the order of means (for categorical variables)
and/or regression coefficients (for continuous variables), depending on the scenario:</p><ul><li><p><em>Categorical variables without interactions</em>: Requires marginal means for each level of the categorical variable(s).</p></li>
<li><p><em>Interactions among categorical variables</em>: Requires conditional (cell) means for all level combinations.</p></li>
<li><p><em>Numerical variables without interactions</em>: Requires regression coefficients.
The intercept must also be included if there are no categorical variables in the model.</p></li>
<li><p><em>Interactions among numerical variables</em>: Requires regression coefficients for both main effects and interaction terms.
The intercept must also be included if there are no categorical variables in the model.</p></li>
<li><p><em>Categorical-by-numerical interactions</em>: Requires regression coefficients for the numerical variable
at each level of the categorical variable, as well as marginal means for the levels of the categorical variable.</p></li>
</ul><p>Note: For models containing only numerical variables, the inputs for <code>means</code> and <code>beta</code> are identical.
See the "Examples" for illustrative scenarios.</p></li>
<li><p><strong>Template for <code>vcomp</code></strong>: Represents a variance-covariance matrix, where integers indicate
the order of variance components in the input vector.</p></li>
</ul></li>
<li><p><strong>correlation</strong>: Various correlation structures can be specified following the instructions from <a href="https://rdrr.io/pkg/nlme/man/corClasses.html" class="external-link">nlme::corClasses</a>.</p>
<p>Note: In <code><a href="https://rdrr.io/pkg/nlme/man/corAR1.html" class="external-link">nlme::corAR1()</a></code> and <code><a href="https://rdrr.io/pkg/nlme/man/corARMA.html" class="external-link">nlme::corARMA()</a></code> when <code>p=1</code> and <code>q=0</code>, the time variable must be an integer.
However, in <code>pwr4exp</code>, this restriction has been released, factors are also supported.</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="co"># Using templates for specifying "means"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Create an example data frame with four categorical variables (factors)</span></span></span>
<span class="r-in"><span><span class="co"># and two numerical variables</span></span></span>
<span class="r-in"><span><span class="va">df1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expand.grid.html" class="external-link">expand.grid</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  fA <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  fB <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  fC <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  fD <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  subject <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df1</span><span class="op">$</span><span class="va">x</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Numerical variable x</span></span></span>
<span class="r-in"><span><span class="va">df1</span><span class="op">$</span><span class="va">z</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">df1</span><span class="op">)</span><span class="op">)</span>  <span class="co"># Numerical variable z</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Categorical variables without interactions</span></span></span>
<span class="r-in"><span><span class="co"># Means of each level of fA and fB are required in sequence.</span></span></span>
<span class="r-in"><span><span class="fu">mkdesign</span><span class="op">(</span><span class="op">~</span> <span class="va">fA</span> <span class="op">+</span> <span class="va">fB</span>, <span class="va">df1</span><span class="op">)</span><span class="op">$</span><span class="va">fixeff</span><span class="op">$</span><span class="va">means</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fA1 fA2 fB1 fB2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1   2   3   4 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Interactions among categorical variables</span></span></span>
<span class="r-in"><span><span class="co"># Cell means for all combinations of levels of fA and fB are required.</span></span></span>
<span class="r-in"><span><span class="fu">mkdesign</span><span class="op">(</span><span class="op">~</span> <span class="va">fA</span> <span class="op">*</span> <span class="va">fB</span>, <span class="va">df1</span><span class="op">)</span><span class="op">$</span><span class="va">fixeff</span><span class="op">$</span><span class="va">means</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fA1:fB1 fA2:fB1 fA1:fB2 fA2:fB2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       1       2       3       4 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Numerical variables without and with interactions, identical to beta.</span></span></span>
<span class="r-in"><span><span class="co"># Without interactions: Regression coefficients are required</span></span></span>
<span class="r-in"><span><span class="fu">mkdesign</span><span class="op">(</span><span class="op">~</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, <span class="va">df1</span><span class="op">)</span><span class="op">$</span><span class="va">fixeff</span><span class="op">$</span><span class="va">means</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)           x           z </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           1           2           3 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># With interactions: Coefficients for main effects and interaction terms are required.</span></span></span>
<span class="r-in"><span><span class="fu">mkdesign</span><span class="op">(</span><span class="op">~</span> <span class="va">x</span> <span class="op">*</span> <span class="va">z</span>, <span class="va">df1</span><span class="op">)</span><span class="op">$</span><span class="va">fixeff</span><span class="op">$</span><span class="va">means</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)           x           z         x:z </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           1           2           3           4 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Categorical-by-numerical interactions</span></span></span>
<span class="r-in"><span><span class="co"># Marginal means for each level of fA, and regression coefficients for x</span></span></span>
<span class="r-in"><span><span class="co"># at each level of fA are required.</span></span></span>
<span class="r-in"><span><span class="fu">mkdesign</span><span class="op">(</span><span class="op">~</span> <span class="va">fA</span> <span class="op">*</span> <span class="va">x</span>, <span class="va">df1</span><span class="op">)</span><span class="op">$</span><span class="va">fixeff</span><span class="op">$</span><span class="va">means</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   fA1   fA2 fA1:x fA2:x </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     1     2     3     4 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Three factors with interactions:</span></span></span>
<span class="r-in"><span><span class="co"># Cell means for all 12 combinations of the levels of fA, fB, and fC are required.</span></span></span>
<span class="r-in"><span><span class="fu">mkdesign</span><span class="op">(</span><span class="op">~</span> <span class="va">fA</span> <span class="op">*</span> <span class="va">fB</span> <span class="op">*</span> <span class="va">fC</span>, <span class="va">df1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $fixeff</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $fixeff$beta</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)         fA2         fB2         fC2         fC3     fA2:fB2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           1           2           3           4           5           6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>     fA2:fC2     fA2:fC3     fB2:fC2     fB2:fC3 fA2:fB2:fC2 fA2:fB2:fC3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           7           8           9          10          11          12 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $fixeff$means</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fA1:fB1:fC1 fA2:fB1:fC1 fA1:fB2:fC1 fA2:fB2:fC1 fA1:fB1:fC2 fA2:fB1:fC2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           1           2           3           4           5           6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fA1:fB2:fC2 fA2:fB2:fC2 fA1:fB1:fC3 fA2:fB1:fC3 fA1:fB2:fC3 fA2:fB2:fC3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           7           8           9          10          11          12 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $varcov</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A design that mixes the above-mentioned scenarios:</span></span></span>
<span class="r-in"><span><span class="co"># - Interactions among three categorical variables (fA, fB, fC)</span></span></span>
<span class="r-in"><span><span class="co"># - A categorical-by-numerical interaction (fD * x)</span></span></span>
<span class="r-in"><span><span class="co"># - Main effects for another numerical variable (z)</span></span></span>
<span class="r-in"><span><span class="co"># The required inputs are:</span></span></span>
<span class="r-in"><span><span class="co"># - Cell means for all combinations of levels of fA, fB, and fC</span></span></span>
<span class="r-in"><span><span class="co"># - Means for each level of fD</span></span></span>
<span class="r-in"><span><span class="co"># - Regression coefficients for x at each level of fD</span></span></span>
<span class="r-in"><span><span class="co"># - Regression coefficients for z</span></span></span>
<span class="r-in"><span><span class="fu">mkdesign</span><span class="op">(</span><span class="op">~</span> <span class="va">fA</span> <span class="op">*</span> <span class="va">fB</span> <span class="op">*</span> <span class="va">fC</span> <span class="op">+</span> <span class="va">fD</span> <span class="op">*</span> <span class="va">x</span> <span class="op">+</span> <span class="va">z</span>, <span class="va">df1</span><span class="op">)</span><span class="op">$</span><span class="va">fixeff</span><span class="op">$</span><span class="va">means</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         fD1         fD2         fD3           z       fD1:x       fD2:x </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           1           2           3           4           5           6 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       fD3:x fA1:fB1:fC1 fA2:fB1:fC1 fA1:fB2:fC1 fA2:fB2:fC1 fA1:fB1:fC2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>           7           8           9          10          11          12 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fA2:fB1:fC2 fA1:fB2:fC2 fA2:fB2:fC2 fA1:fB1:fC3 fA2:fB1:fC3 fA1:fB2:fC3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          13          14          15          16          17          18 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fA2:fB2:fC3 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          19 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Using templates for specifying "vcomp"</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Assume df1 represents an RCBD with "subject" as a random blocking factor.</span></span></span>
<span class="r-in"><span><span class="co">## Variance of the random effect "subject" (intercept) is required.</span></span></span>
<span class="r-in"><span><span class="fu">mkdesign</span><span class="op">(</span><span class="op">~</span> <span class="va">fA</span> <span class="op">*</span> <span class="va">fB</span> <span class="op">*</span> <span class="va">fC</span> <span class="op">*</span> <span class="va">fD</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">subject</span><span class="op">)</span>, <span class="va">df1</span><span class="op">)</span><span class="op">$</span><span class="va">varcov</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $subject</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept)</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)           1</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Demonstration of templates for more complex random effects</span></span></span>
<span class="r-in"><span><span class="co">## Note: This example is a demo and statistically incorrect for this data</span></span></span>
<span class="r-in"><span><span class="co">## (no replicates under subject*fA). It only illustrates variance-covariance templates.</span></span></span>
<span class="r-in"><span><span class="co">## Inputs required:</span></span></span>
<span class="r-in"><span><span class="co">## - Variance of the random intercept (1st)</span></span></span>
<span class="r-in"><span><span class="co">## - Covariance between the intercept and "fA2" (2nd)</span></span></span>
<span class="r-in"><span><span class="co">## - Variance of "fA2" (3rd)</span></span></span>
<span class="r-in"><span><span class="fu">mkdesign</span><span class="op">(</span><span class="op">~</span> <span class="va">fA</span> <span class="op">*</span> <span class="va">fB</span> <span class="op">*</span> <span class="va">fC</span> <span class="op">*</span> <span class="va">fD</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">fA</span> <span class="op">|</span> <span class="va">subject</span><span class="op">)</span>, <span class="va">df1</span><span class="op">)</span><span class="op">$</span><span class="va">varcov</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> $subject</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             (Intercept) fA2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> (Intercept)           1   2</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> fA2                   2   3</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Power analysis for repeated measures</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create a data frame for a CRD with repeated measures</span></span></span>
<span class="r-in"><span><span class="va">n_subject</span> <span class="op">&lt;-</span> <span class="fl">6</span></span></span>
<span class="r-in"><span><span class="va">n_trt</span> <span class="op">&lt;-</span> <span class="fl">3</span></span></span>
<span class="r-in"><span><span class="va">n_hour</span> <span class="op">&lt;-</span> <span class="fl">8</span></span></span>
<span class="r-in"><span><span class="va">trt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"CON"</span>, <span class="st">"TRT1"</span>, <span class="st">"TRT2"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">df2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span></span>
<span class="r-in"><span>  subject <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_trt</span> <span class="op">*</span> <span class="va">n_subject</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">n_hour</span><span class="op">)</span><span class="op">)</span>, <span class="co"># Subject as a factor</span></span></span>
<span class="r-in"><span>  hour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">n_hour</span><span class="op">)</span>, <span class="va">n_subject</span> <span class="op">*</span> <span class="va">n_trt</span><span class="op">)</span><span class="op">)</span>,           <span class="co"># Hour as a factor</span></span></span>
<span class="r-in"><span>  trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">trt</span>, each <span class="op">=</span> <span class="va">n_subject</span> <span class="op">*</span> <span class="va">n_hour</span><span class="op">)</span>                           <span class="co"># Treatment as a factor</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Templates</span></span></span>
<span class="r-in"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu">mkdesign</span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">trt</span> <span class="op">*</span> <span class="va">hour</span>, data <span class="op">=</span> <span class="va">df2</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">temp</span><span class="op">$</span><span class="va">fixeff</span><span class="op">$</span><span class="va">means</span>  <span class="co"># Fixed effects means template</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  trtCON:hour1 trtTRT1:hour1 trtTRT2:hour1  trtCON:hour2 trtTRT1:hour2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             1             2             3             4             5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> trtTRT2:hour2  trtCON:hour3 trtTRT1:hour3 trtTRT2:hour3  trtCON:hour4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             6             7             8             9            10 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> trtTRT1:hour4 trtTRT2:hour4  trtCON:hour5 trtTRT1:hour5 trtTRT2:hour5 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            11            12            13            14            15 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  trtCON:hour6 trtTRT1:hour6 trtTRT2:hour6  trtCON:hour7 trtTRT1:hour7 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            16            17            18            19            20 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> trtTRT2:hour7  trtCON:hour8 trtTRT1:hour8 trtTRT2:hour8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            21            22            23            24 </span>
<span class="r-in"><span><span class="va">temp</span><span class="op">$</span><span class="va">vcov</span>          <span class="co"># Variance-covariance template</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> NULL</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Create a design object</span></span></span>
<span class="r-in"><span><span class="co"># Assume repeated measures within a subject follow an AR1 process with a correlation of 0.6</span></span></span>
<span class="r-in"><span><span class="va">design</span> <span class="op">&lt;-</span> <span class="fu">mkdesign</span><span class="op">(</span></span></span>
<span class="r-in"><span>  formula <span class="op">=</span> <span class="op">~</span> <span class="va">trt</span> <span class="op">*</span> <span class="va">hour</span>,</span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">df2</span>,</span></span>
<span class="r-in"><span>  means <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2.50</span>, <span class="fl">3.50</span>,</span></span>
<span class="r-in"><span>            <span class="fl">1</span>, <span class="fl">3.50</span>, <span class="fl">4.54</span>,</span></span>
<span class="r-in"><span>            <span class="fl">1</span>, <span class="fl">3.98</span>, <span class="fl">5.80</span>,</span></span>
<span class="r-in"><span>            <span class="fl">1</span>, <span class="fl">4.03</span>, <span class="fl">5.40</span>,</span></span>
<span class="r-in"><span>            <span class="fl">1</span>, <span class="fl">3.68</span>, <span class="fl">5.49</span>,</span></span>
<span class="r-in"><span>            <span class="fl">1</span>, <span class="fl">3.35</span>, <span class="fl">4.71</span>,</span></span>
<span class="r-in"><span>            <span class="fl">1</span>, <span class="fl">3.02</span>, <span class="fl">4.08</span>,</span></span>
<span class="r-in"><span>            <span class="fl">1</span>, <span class="fl">2.94</span>, <span class="fl">3.78</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>  sigma2 <span class="op">=</span> <span class="fl">2</span>,</span></span>
<span class="r-in"><span>  correlation <span class="op">=</span> <span class="fu">corAR1</span><span class="op">(</span>value <span class="op">=</span> <span class="fl">0.6</span>, form <span class="op">=</span> <span class="op">~</span> <span class="va">hour</span> <span class="op">|</span> <span class="va">subject</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="pwr.anova.html">pwr.anova</a></span><span class="op">(</span><span class="va">design</span><span class="op">)</span>  <span class="co"># Perform power analysis</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Power of type III F-test</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>          NumDF  DenDF sig.level   power</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> trt          2 21.563      0.05 1.00000</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> hour         7 86.055      0.05 0.74687</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> trt:hour    14 86.055      0.05 0.38500</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## When time is treated as a numeric variable</span></span></span>
<span class="r-in"><span><span class="co"># Means of treatments and regression coefficients for hour at each treatment level are required</span></span></span>
<span class="r-in"><span><span class="va">df2</span><span class="op">$</span><span class="va">hour</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/integer.html" class="external-link">as.integer</a></span><span class="op">(</span><span class="va">df2</span><span class="op">$</span><span class="va">hour</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu">mkdesign</span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">trt</span> <span class="op">*</span> <span class="va">hour</span>, data <span class="op">=</span> <span class="va">df2</span><span class="op">)</span><span class="op">$</span><span class="va">fixeff</span><span class="op">$</span><span class="va">means</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>       trtCON      trtTRT1      trtTRT2  trtCON:hour trtTRT1:hour trtTRT2:hour </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            1            2            3            4            5            6 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Polynomial terms of time in the model</span></span></span>
<span class="r-in"><span><span class="fu">mkdesign</span><span class="op">(</span>formula <span class="op">=</span> <span class="op">~</span> <span class="va">trt</span> <span class="op">+</span> <span class="va">hour</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">hour</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">trt</span><span class="op">:</span><span class="va">hour</span> <span class="op">+</span> <span class="va">trt</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/AsIs.html" class="external-link">I</a></span><span class="op">(</span><span class="va">hour</span><span class="op">^</span><span class="fl">2</span><span class="op">)</span>, data <span class="op">=</span> <span class="va">df2</span><span class="op">)</span><span class="op">$</span><span class="va">fixeff</span><span class="op">$</span><span class="va">means</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            trtCON           trtTRT1           trtTRT2       trtCON:hour </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 1                 2                 3                 4 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      trtTRT1:hour      trtTRT2:hour  trtCON:I(hour^2) trtTRT1:I(hour^2) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 5                 6                 7                 8 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> trtTRT2:I(hour^2) </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>                 9 </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Kai Wang, Mutian Niu.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

